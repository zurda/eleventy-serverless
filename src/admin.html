<style>
    h1,
    form,
    .message,
    .logout {
        margin: 0 auto;
        max-width: 400px;
        width: 90vw;
    }

    .logout {
        display: block;
        margin-bottom: 2rem;
    }

    label,
    button {
        display: block;
        font-size: 1rem;
        font-variant: small-caps;
        font-weight: normal;
        letter-spacing: 0.15em;
    }

    label {
        margin: 0.5rem 0 0;
        text-transform: lowercase;
    }

    input {
        border: 1px solid var(--text-muted);
        border-radius: 0.25rem;
        display: block;
        font-family: var(--font-family);
        font-size: 1rem;
        padding: 0.5rem;
        width: 100%;
    }

    button {
        background: var(--green);
        border: 0;
        border-radius: 0.25rem;
        color: var(--white);
        font-family: var(--font-family);
        margin: 1rem 0 0;
        padding: 0.5rem 1rem;
        text-transform: uppercase;
    }

    .message {
        background: var(--orange);
        border-radius: 0.25rem;
        font-family: monospace;
        padding: 1rem;
    }

    .message:empty {
        display: none;
    }
</style>

<a href="#logout" class="logout">Log Out</a>

<h1>Add a new team member</h1>
<div class="message"></div>
<form id="add-team-member">
    <label for="member_name">Member Name<input type="text" id="member_name" name="member_name" required /></label>
    <label for="team_name">Team Name <input type="text" id="team_name" name="team_name" required /></label>
    <button type="submit">Add New Team Member</button>
</form>

<script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<script>
    function handleIdentityEvent(user) {
        if (user && user.token) {
            return;
        }

        window.location.pathname = '/login/';
    }

    netlifyIdentity.on('init', handleIdentityEvent);
    netlifyIdentity.on('logout', handleIdentityEvent);

    document.querySelector('.logout').addEventListener('click', (event) => {
        event.preventDefault();
        netlifyIdentity.logout();
    });

    async function handleSubmit(event) {
        event.preventDefault();

        const { access_token } = netlifyIdentity.currentUser().token;
        const data = new FormData(event.target);

        const result = await fetch('/.netlify/functions/add-team-member', {
            method: 'POST',
            headers: {
                Authorization: `Bearer ${access_token}`,
            },
            body: JSON.stringify({
                member_name: data.get('member_name'),
                team_name: data.get('team_name'),
            }),
        }).then((response) => {
            document.querySelector(
                '.message',
            ).innerText = `Response: ${response.status} â€” ${response.statusText}`;
        });
    }

    document.querySelector('#add-team-member').addEventListener('submit', handleSubmit);
</script>